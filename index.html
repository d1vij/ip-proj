<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divij Verma IP Project</title>

    <!-- FiraCode Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet">

    <!-- prism.css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.min.css">
    <!-- prism.min.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/prism.min.js"
        integrity="sha512-UOoJElONeUNzQbbKQbjldDf9MwOHqxNz49NNJJ1d90yp+X9edsHyJoAs6O4K19CZGaIdjI5ohK+O2y5lBTW6uQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- prism-python.min.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/components/prism-python.min.js"
        integrity="sha512-3qtI9+9JXi658yli19POddU1RouYtkTEhTHo6X5ilOvMiDfNvo6GIS6k2Ukrsx8MyaKSXeVrnIWeyH8G5EOyIQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- prism-javascript-min.js -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/components/prism-javascript.min.js" integrity="sha512-yvw5BDA/GQu8umskpIOBhX2pDLrdOiriaK4kVxtD28QEGLV5rscmCfDjkrx52tIgzLgwzs1FsALV6eYDpGnEkQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <link rel="stylesheet" crossorigin href="/ip-proj/assets/index-CXw5lLmR.css">
</head>


<!-- custom stylesheet -->

<body>
    <main>


        
        
        
        
        
        
        
        
        
        
        
        

  
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
from time import time
start_time = time()
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# chalk substitutes
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
%pip install pandas matplotlib pymongo pychalk --no-cache-dir nbconvert
                </code>
                </pre>
                <div class="output">
                <pre>
Requirement already satisfied: pandas in ./.venv/lib/python3.12/site-packages (2.3.1)
Requirement already satisfied: matplotlib in ./.venv/lib/python3.12/site-packages (3.10.5)
Requirement already satisfied: pymongo in ./.venv/lib/python3.12/site-packages (4.14.0)
Requirement already satisfied: pychalk in ./.venv/lib/python3.12/site-packages (2.0.1)
Requirement already satisfied: nbconvert in ./.venv/lib/python3.12/site-packages (7.16.6)
Requirement already satisfied: numpy>=1.26.0 in ./.venv/lib/python3.12/site-packages (from pandas) (2.3.2)
Requirement already satisfied: python-dateutil>=2.8.2 in ./.venv/lib/python3.12/site-packages (from pandas) (2.9.0.post0)
Requirement already satisfied: pytz>=2020.1 in ./.venv/lib/python3.12/site-packages (from pandas) (2025.2)
Requirement already satisfied: tzdata>=2022.7 in ./.venv/lib/python3.12/site-packages (from pandas) (2025.2)
Requirement already satisfied: contourpy>=1.0.1 in ./.venv/lib/python3.12/site-packages (from matplotlib) (1.3.3)
Requirement already satisfied: cycler>=0.10 in ./.venv/lib/python3.12/site-packages (from matplotlib) (0.12.1)
Requirement already satisfied: fonttools>=4.22.0 in ./.venv/lib/python3.12/site-packages (from matplotlib) (4.59.0)
Requirement already satisfied: kiwisolver>=1.3.1 in ./.venv/lib/python3.12/site-packages (from matplotlib) (1.4.9)
Requirement already satisfied: packaging>=20.0 in ./.venv/lib/python3.12/site-packages (from matplotlib) (25.0)
Requirement already satisfied: pillow>=8 in ./.venv/lib/python3.12/site-packages (from matplotlib) (11.3.0)
Requirement already satisfied: pyparsing>=2.3.1 in ./.venv/lib/python3.12/site-packages (from matplotlib) (3.2.3)
Requirement already satisfied: platformdirs>=2.5 in ./.venv/lib/python3.12/site-packages (from jupyter-core>=4.7->nbconvert) (4.3.8)
Requirement already satisfied: jupyter-client>=6.1.12 in ./.venv/lib/python3.12/site-packages (from nbclient>=0.5.0->nbconvert) (8.6.3)
Requirement already satisfied: fastjsonschema>=2.15 in ./.venv/lib/python3.12/site-packages (from nbformat>=5.7->nbconvert) (2.21.1)
Requirement already satisfied: jsonschema>=2.6 in ./.venv/lib/python3.12/site-packages (from nbformat>=5.7->nbconvert) (4.25.0)
Requirement already satisfied: soupsieve>1.2 in ./.venv/lib/python3.12/site-packages (from beautifulsoup4->nbconvert) (2.7)
Requirement already satisfied: typing-extensions>=4.0.0 in ./.venv/lib/python3.12/site-packages (from beautifulsoup4->nbconvert) (4.14.1)
Requirement already satisfied: attrs>=22.2.0 in ./.venv/lib/python3.12/site-packages (from jsonschema>=2.6->nbformat>=5.7->nbconvert) (25.3.0)
Requirement already satisfied: jsonschema-specifications>=2023.03.6 in ./.venv/lib/python3.12/site-packages (from jsonschema>=2.6->nbformat>=5.7->nbconvert) (2025.4.1)
Requirement already satisfied: referencing>=0.28.4 in ./.venv/lib/python3.12/site-packages (from jsonschema>=2.6->nbformat>=5.7->nbconvert) (0.36.2)
Requirement already satisfied: rpds-py>=0.7.1 in ./.venv/lib/python3.12/site-packages (from jsonschema>=2.6->nbformat>=5.7->nbconvert) (0.27.0)
Requirement already satisfied: pyzmq>=23.0 in ./.venv/lib/python3.12/site-packages (from jupyter-client>=6.1.12->nbclient>=0.5.0->nbconvert) (27.0.1)
Requirement already satisfied: tornado>=6.2 in ./.venv/lib/python3.12/site-packages (from jupyter-client>=6.1.12->nbclient>=0.5.0->nbconvert) (6.5.2)
Note: you may need to restart the kernel to use updated packages.

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
import os
import csv
import pymongo
import json
import chalk
import sqlite3

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
chalk.red = lambda x: x
chalk.green = lambda x: x
chalk.blue = lambda x: x
chalk.yellow = lambda x: x
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
CONNECTION_URL = "mongodb+srv://vermadivij:elections@cluster1.kicphp2.mongodb.net/?retryWrites=true&w=majority&appName=cluster1"
DATABASE_NAME = "votes"
CLASSES = [
    "10A",
    "10B",
    "10C",
    "10D",
    "10E",
    "10F",
    "10G",
    "10H",
    "10I",
    "10J",
    "11A",
    "11B",
    "11C",
    "11D",
    "11E",
    "12A",
    "12B",
    "12C",
    "12D",
    "9A",
    "9B",
    "9C",
    "9D",
    "9E",
    "9F",
    "9G",
    "9H",
    "9I",
    "9J",
    "absentees",
    "candidates",
]

_SPACE = " "
_UNDERSCORE = "_"
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
print("HEllo world")
print(" world")
                </code>
                </pre>
                <div class="output">
                <pre>
HEllo world
 world

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
def replace_spaces(string: str, replace_with=_UNDERSCORE):
    return string.replace(_SPACE, replace_with)
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
def fetch_and_parse(collection_name: str) -> dict:

    conn = pymongo.MongoClient(CONNECTION_URL)
    database = conn.get_database(DATABASE_NAME)

    RESULTS: dict[str, dict[str, int]] = {}

    collection = database.get_collection(collection_name)
    found_documents: list[dict] = list(collection.find({}))

    for doc in found_documents:
        vote_data: list[dict[str, str]] = doc["vote_data"]

        for vote_obj in vote_data:
            post = vote_obj["post"]
            voted_candidate = vote_obj["name"]

            # post doesnt exist
            if post not in RESULTS:
                RESULTS[post] = {}

            # post exists
            RESULTS[post][voted_candidate] = RESULTS[post].get(voted_candidate, 0) + 1

    return RESULTS


def save_to_csv(data: dict, path: str):
    # create path if it doesnt exists
    if not (os.path.exists(path)):
        open(path, "x").close()

    with open(path, "w+") as file:

        writer = csv.writer(file)
        writer.writerow(["Post", "Candidate", "Total Votes"])

        for postname, candidates in data.items():
            for name, votes in candidates.items():
                writer.writerow([postname, name, votes])
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
file_paths = [
    os.path.join(os.getcwd(), "class-wise", collection + ".csv")
    for collection in CLASSES
]

with open("candidate-data.json", "r") as file:
    # since all files would have the same posts and candidates
    # reading the columns from any of it would work
    candidate_data = json.loads(file.read())


def compile_single_class(file_path: str):
    with open(file_path, "r") as file:
        reader = csv.reader(file)

        # skipping column names row
        next(reader)

        candidates = {
            post: {name: 0 for name in names} for post, names in candidate_data.items()
        }
        for line in reader:
            post = line[0]
            name = line[1]
            votes = int(line[2])
            candidates[post][name] = votes

    return candidates


def compile_csvs_to_json():

    # empty dictionary to store the compiled vote data
    compiled_json = {
        post_name: {
            class_name: {name: 0 for name in candidate_data[post_name]}
            for class_name in CLASSES
        }
        for post_name in candidate_data.keys()
    }

    for curr_class in CLASSES:
        class_wise_votes = compile_single_class(
            os.path.join(os.getcwd(), "class-wise", curr_class + ".csv")
        )
        for post, candidates in class_wise_votes.items():
            for name, votes in candidates.items():
                compiled_json[post][curr_class][name] += votes

    return compiled_json


def create_dataframes():
    compiled = compile_csvs_to_json()
    dataframes = {}

    for post in compiled:
        post_dataframe = pd.DataFrame(
            compiled[post]
        ).T  # transpose cuz otherwise there would be 31 columns
        dataframes[post] = post_dataframe

    return dataframes
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
from sqlite3 import OperationalError
from typing import Union, Literal


# typings
REPR_UNION = Union[Literal["string"], Literal["list"], None]
QUERY_UNION = Union[None, list[tuple[str]], str, list[str]]


def query(
    query: str,
    *,
    is_updation=False,  # is the current query contains some kind of updation ?? Doesnt return anything if true
    return_repr: REPR_UNION = None,  # Returns output as string or list of lines if passed any of the value. Prints the result if None.
    return_rows=False,  # Return rows as lists of tuples ??
    table_heading: str | None = None,  # Title printed before printing output
) -> QUERY_UNION:
    try:
        results = cursor.execute(query)
    except OperationalError as err:
        print(chalk.red(f"Error in querying -> {query}"))
        print("** Row / Column names with spaces should be enlcosed within quotes **")
        print(err)
        return

    if is_updation:
        return
    if return_rows:
        return results.fetchall()
    else:
        lines: list[str] = []
        # printing table header if provided
        if table_heading is not None:
            print(table_heading)

        # printing column names
        lines.append(" ".join(chalk.green(desc[0]) for desc in results.description))

        # for most part left padding works fine
        label_lengths = [len(desc[0]) for desc in results.description]

        for row in results.fetchall():
            line = []
            for idx, col in enumerate(row):

                # left justifing current column value based on length fo current column's label
                line.append(str(col).ljust(label_lengths[idx] + 1))
            lines.append("".join(line))

        if return_repr == "string":
            return "\n".join(lines)
        elif return_repr == "list":
            return lines
        else:
            print(*lines, sep="\n")
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# NOTE: converting json to csv to again json is redundant and indivisual collections could directly be compiled to final json
BASE_DIR = os.path.join(os.path.dirname(os.getcwd()), "ip-proj", "class-wise")

if not (os.path.exists("class-wise")):
    os.mkdir("class-wise")

for collection in CLASSES:

    # try to save that collection
    try:
        save_to_csv(
            fetch_and_parse(collection),
            os.path.join(BASE_DIR, collection + ".csv"),
        )
        print(f"Saved collection : {collection}")

    # gracefully handle any raised exception
    except Exception as e:
        print(f"Exception occured in saving {collection} document, Exception: {e}")
                </code>
                </pre>
                <div class="output">
                <pre>
Saved collection : 10A
Saved collection : 10B
Saved collection : 10C
Saved collection : 10D
Saved collection : 10E
Saved collection : 10F
Saved collection : 10G
Saved collection : 10H
Saved collection : 10I
Saved collection : 10J
Saved collection : 11A
Saved collection : 11B
Saved collection : 11C
Saved collection : 11D
Saved collection : 11E
Saved collection : 12A
Saved collection : 12B
Saved collection : 12C
Saved collection : 12D
Saved collection : 9A
Saved collection : 9B
Saved collection : 9C
Saved collection : 9D
Saved collection : 9E
Saved collection : 9F
Saved collection : 9G
Saved collection : 9H
Saved collection : 9I
Saved collection : 9J
Saved collection : absentees
Saved collection : candidates

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
result_dataframes = create_dataframes()
print(chalk.green("Found Posts"), *result_dataframes.keys(), sep="\n")
                </code>
                </pre>
                <div class="output">
                <pre>
Found Posts
Captain Boy
Captain Girl
Vice Captain Boy
Vice Captain Girl

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
conn = sqlite3.connect(DATABASE_NAME + ".db")
cursor = conn.cursor()
for name, post_df in result_dataframes.items():
    name = name.replace(_SPACE, _UNDERSCORE)
    post_df.columns = [name.replace(_SPACE, _UNDERSCORE) for name in post_df.columns]
    post_df.to_sql(name, conn, if_exists="replace", index_label="Class")
    conn.commit()
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# captian boy dataframe
cb = result_dataframes["Captain Boy"]
# captian girl dataframe
cg = result_dataframes["Captain Girl"]
# vice captian boy dataframe
vcb = result_dataframes["Vice Captain Boy"]
# vice captian girl dataframe
vcg = result_dataframes["Vice Captain Girl"]
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# test printing rows

print(cg[cg.index.str.contains(r"10\w")])
print(vcb[vcb.index.str.contains(r"11\w")])
print(vcg[vcg.index.str.contains(r"12\w")])
                </code>
                </pre>
                <div class="output">
                <pre>
    Aadityaraje_Desai  Abhichandra_Charke  Praneel_Deshmukh  Rachit_Srivastava
9A                 10                   0                 5                  1
9B                  9                   0                 4                  0
9C                 10                   5                 3                  3
9D                 12                   2                 7                  1
9E                  3                   8                 5                  0
9F                  8                   3                 7                  0
9G                  6                   5                 4                  1
9H                  2                   2                11                  0
9I                 11                   0                 5                  0
9J                  7                   3                10                  1
     Tvisha_Shah  Gauravi_Zade  Kirthika_Jayachander  Naisha_Rastogi
10A            3             5                     1               1
10B            1             7                     0               2
10C            1            12                     0               1
10D            1             9                     0               3
10E            0             7                     0               5
10F            0             4                     2               5
10G            0            11                     0               0
10H            1             9                     0               1
10I            1            13                     2               1
10J            0            12                     1               2
     Kausar_Chandra  Sagnik_Ghosh  Avaneesh_Mahalle  Krishna_Yadav  \
11A               2             5                10              1   
11B               3             0                 1              1   
11C               0             0                 0              0   
11D               0             0                 0              0   
11E               2             0                 7              3   

     Viren_Jadhav  
11A             3  
11B             0  
11C             0  
11D             0  
11E             0  
     Ketaki_Phalle  Trisha_Kandpal  Riya_Shirode  Kavya_Mehta  Sumedha_Vaidya
12A              1               0             1            1               1
12B              3               0             1            2               0
12C              4               1             2            0               1
12D              1               6             0            2               0

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# classes where the candidate has 0 votes
for post_name, post_df in result_dataframes.items():
    print("\n", chalk.blue(post_name), sep="")
    for name in post_df.columns:
        candidate_series = post_df[name]
        empty_vote_classes = candidate_series[candidate_series == 0].index

        print(
            f"{chalk.yellow(name)} {chalk.green("got zero votes in classes->")}",
            *empty_vote_classes,
        )
                </code>
                </pre>
                <div class="output">
                <pre>

Captain Boy
Aadityaraje_Desai got zero votes in classes-> 11C 11D 12C
Abhichandra_Charke got zero votes in classes-> 10F 11C 11D 12A 12C 9A 9B 9I candidates
Praneel_Deshmukh got zero votes in classes-> 11C 11D
Rachit_Srivastava got zero votes in classes-> 10A 10B 10C 10D 10E 10H 10I 10J 11C 11D 11E 12A 12C 12D 9B 9E 9F 9H 9I candidates

Captain Girl
Tvisha_Shah got zero votes in classes-> 10E 10F 10G 10J 11B 11C 11D 12A 12D 9B 9D 9G 9H 9I
Gauravi_Zade got zero votes in classes-> 11C 11D 12A
Kirthika_Jayachander got zero votes in classes-> 10B 10C 10D 10E 10G 10H 11A 11C 11D 12D 9A 9C 9D 9E 9F 9G 9H
Naisha_Rastogi got zero votes in classes-> 10G 11C 11D 12A 12B 9A

Vice Captain Boy
Kausar_Chandra got zero votes in classes-> 10F 10H 11C 11D 9D candidates
Sagnik_Ghosh got zero votes in classes-> 10E 10G 10H 11B 11C 11D 11E 12B 9B 9C 9G 9H
Avaneesh_Mahalle got zero votes in classes-> 11C 11D 12A 12C
Krishna_Yadav got zero votes in classes-> 11C 11D 12C
Viren_Jadhav got zero votes in classes-> 10A 10E 10H 10I 10J 11B 11C 11D 11E 12A 12D 9D

Vice Captain Girl
Ketaki_Phalle got zero votes in classes-> 11B 11C 11D
Trisha_Kandpal got zero votes in classes-> 10C 10G 11A 11C 11D 11E 12A 12B
Riya_Shirode got zero votes in classes-> 10B 10C 10D 10E 10G 10H 10I 10J 11B 11C 11D 11E 12D 9A 9B 9C 9D 9F 9G 9H 9I absentees
Kavya_Mehta got zero votes in classes-> 10B 10F 10G 10H 10J 11B 11C 11D 12C 9A absentees
Sumedha_Vaidya got zero votes in classes-> 10A 10D 10E 10G 11C 11D 11E 12B 12D 9B 9C 9E 9G 9H

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
for post_name, post_df in result_dataframes.items():
    for name in post_df.columns:
        query(
            f"select class as {name} from {replace_spaces(post_name)} where {name} == 0"
        )
        print()
                </code>
                </pre>
                <div class="output">
                <pre>
Aadityaraje_Desai
11C               
11D               
12C               

Abhichandra_Charke
10F                
11C                
11D                
12A                
12C                
9A                 
9B                 
9I                 
candidates         

Praneel_Deshmukh
11C              
11D              

Rachit_Srivastava
10A               
10B               
10C               
10D               
10E               
10H               
10I               
10J               
11C               
11D               
11E               
12A               
12C               
12D               
9B                
9E                
9F                
9H                
9I                
candidates        

Tvisha_Shah
10E         
10F         
10G         
10J         
11B         
11C         
11D         
12A         
12D         
9B          
9D          
9G          
9H          
9I          

Gauravi_Zade
11C          
11D          
12A          

Kirthika_Jayachander
10B                  
10C                  
10D                  
10E                  
10G                  
10H                  
11A                  
11C                  
11D                  
12D                  
9A                   
9C                   
9D                   
9E                   
9F                   
9G                   
9H                   

Naisha_Rastogi
10G            
11C            
11D            
12A            
12B            
9A             

Kausar_Chandra
10F            
10H            
11C            
11D            
9D             
candidates     

Sagnik_Ghosh
10E          
10G          
10H          
11B          
11C          
11D          
11E          
12B          
9B           
9C           
9G           
9H           

Avaneesh_Mahalle
11C              
11D              
12A              
12C              

Krishna_Yadav
11C           
11D           
12C           

Viren_Jadhav
10A          
10E          
10H          
10I          
10J          
11B          
11C          
11D          
11E          
12A          
12D          
9D           

Ketaki_Phalle
11B           
11C           
11D           

Trisha_Kandpal
10C            
10G            
11A            
11C            
11D            
11E            
12A            
12B            

Riya_Shirode
10B          
10C          
10D          
10E          
10G          
10H          
10I          
10J          
11B          
11C          
11D          
11E          
12D          
9A           
9B           
9C           
9D           
9F           
9G           
9H           
9I           
absentees    

Kavya_Mehta
10B         
10F         
10G         
10H         
10J         
11B         
11C         
11D         
12C         
9A          
absentees   

Sumedha_Vaidya
10A            
10D            
10E            
10G            
11C            
11D            
11E            
12B            
12D            
9B             
9C             
9E             
9G             
9H             


                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# classes where a candidate won majority of votes

for post_name, post_df in result_dataframes.items():
    print("\n", chalk.green(name), sep="")
    print(post_df.idxmax())
    print()
                </code>
                </pre>
                <div class="output">
                <pre>

Sumedha_Vaidya
Aadityaraje_Desai      9D
Abhichandra_Charke     9E
Praneel_Deshmukh      10J
Rachit_Srivastava     12B
dtype: object


Sumedha_Vaidya
Tvisha_Shah             11A
Gauravi_Zade             9D
Kirthika_Jayachander    12A
Naisha_Rastogi          11A
dtype: object


Sumedha_Vaidya
Kausar_Chandra       9C
Sagnik_Ghosh        11A
Avaneesh_Mahalle     9D
Krishna_Yadav        9J
Viren_Jadhav         9A
dtype: object


Sumedha_Vaidya
Ketaki_Phalle      9C
Trisha_Kandpal     9A
Riya_Shirode      12C
Kavya_Mehta        9D
Sumedha_Vaidya    10B
dtype: object


                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
for post_name, post_df in result_dataframes.items():
    for name in post_df.columns:
        print(chalk.yellow(name))
        query(f"select max({name}) as 'Got Votes', class from {replace_spaces(post_name)}")

                </code>
                </pre>
                <div class="output">
                <pre>
Aadityaraje_Desai
Got Votes Class
12        9D    
Abhichandra_Charke
Got Votes Class
8         9E    
Praneel_Deshmukh
Got Votes Class
11        10J   
Rachit_Srivastava
Got Votes Class
3         12B   
Tvisha_Shah
Got Votes Class
5         11A   
Gauravi_Zade
Got Votes Class
19        9D    
Kirthika_Jayachander
Got Votes Class
4         12A   
Naisha_Rastogi
Got Votes Class
9         11A   
Kausar_Chandra
Got Votes Class
8         9C    
Sagnik_Ghosh
Got Votes Class
5         11A   
Avaneesh_Mahalle
Got Votes Class
13        9D    
Krishna_Yadav
Got Votes Class
8         9J    
Viren_Jadhav
Got Votes Class
6         9A    
Ketaki_Phalle
Got Votes Class
17        9C    
Trisha_Kandpal
Got Votes Class
11        9A    
Riya_Shirode
Got Votes Class
2         12C   
Kavya_Mehta
Got Votes Class
13        9D    
Sumedha_Vaidya
Got Votes Class
5         10B   

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# mean votes a candidate got across all classes

for post_name, post_df in result_dataframes.items():
    print(chalk.green(post_name))
    print(post_df.mean())
    query(
        f"""select {', '.join([f'round(avg({name}), 6) as {name}' for name in post_df.columns])}
                    from {replace_spaces(post_name)}
                """
    )
    print()
                </code>
                </pre>
                <div class="output">
                <pre>
Captain Boy
Aadityaraje_Desai     4.774194
Abhichandra_Charke    2.258065
Praneel_Deshmukh      4.870968
Rachit_Srivastava     0.516129
dtype: float64
Aadityaraje_Desai Abhichandra_Charke Praneel_Deshmukh Rachit_Srivastava
4.774194          2.258065           4.870968         0.516129          

Captain Girl
Tvisha_Shah             1.322581
Gauravi_Zade            8.129032
Kirthika_Jayachander    0.645161
Naisha_Rastogi          2.322581
dtype: float64
Tvisha_Shah Gauravi_Zade Kirthika_Jayachander Naisha_Rastogi
1.322581    8.129032     0.645161             2.322581       

Vice Captain Boy
Kausar_Chandra      2.645161
Sagnik_Ghosh        1.161290
Avaneesh_Mahalle    4.387097
Krishna_Yadav       2.483871
Viren_Jadhav        1.741935
dtype: float64
Kausar_Chandra Sagnik_Ghosh Avaneesh_Mahalle Krishna_Yadav Viren_Jadhav
2.645161       1.16129      4.387097         2.483871      1.741935     

Vice Captain Girl
Ketaki_Phalle     5.645161
Trisha_Kandpal    2.580645
Riya_Shirode      0.354839
Kavya_Mehta       2.709677
Sumedha_Vaidya    1.129032
dtype: float64
Ketaki_Phalle Trisha_Kandpal Riya_Shirode Kavya_Mehta Sumedha_Vaidya
5.645161      2.580645       0.354839     2.709677    1.129032       


                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# median votes a candidate got across all classes

for post_name, post_df in result_dataframes.items():
    print(chalk.green(post_name))
    print(post_df.median())
    print()

# ---no sql equivalent for median---
                </code>
                </pre>
                <div class="output">
                <pre>
Captain Boy
Aadityaraje_Desai     4.0
Abhichandra_Charke    2.0
Praneel_Deshmukh      4.0
Rachit_Srivastava     0.0
dtype: float64

Captain Girl
Tvisha_Shah             1.0
Gauravi_Zade            9.0
Kirthika_Jayachander    0.0
Naisha_Rastogi          2.0
dtype: float64

Vice Captain Boy
Kausar_Chandra      3.0
Sagnik_Ghosh        1.0
Avaneesh_Mahalle    4.0
Krishna_Yadav       2.0
Viren_Jadhav        1.0
dtype: float64

Vice Captain Girl
Ketaki_Phalle     5.0
Trisha_Kandpal    2.0
Riya_Shirode      0.0
Kavya_Mehta       1.0
Sumedha_Vaidya    1.0
dtype: float64


                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# calculating modal votes would be irrelevant
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# total votes across all classes
for post_name, post_df in result_dataframes.items():
    print(chalk.green(post_name))
    print(post_df.sum())
    print()
                </code>
                </pre>
                <div class="output">
                <pre>
Captain Boy
Aadityaraje_Desai     148
Abhichandra_Charke     70
Praneel_Deshmukh      151
Rachit_Srivastava      16
dtype: int64

Captain Girl
Tvisha_Shah              41
Gauravi_Zade            252
Kirthika_Jayachander     20
Naisha_Rastogi           72
dtype: int64

Vice Captain Boy
Kausar_Chandra       82
Sagnik_Ghosh         36
Avaneesh_Mahalle    136
Krishna_Yadav        77
Viren_Jadhav         54
dtype: int64

Vice Captain Girl
Ketaki_Phalle     175
Trisha_Kandpal     80
Riya_Shirode       11
Kavya_Mehta        84
Sumedha_Vaidya     35
dtype: int64


                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# equivalent sql query
for post_name, post_df in result_dataframes.items():
    query(
        f"""
        select {', '.join([f"sum({name}) as {name}" for name in post_df.columns])}
        from {replace_spaces(post_name)}
        """,
        table_heading=chalk.blue("Total Votes"),
    )
    print()
                </code>
                </pre>
                <div class="output">
                <pre>
Total Votes
Aadityaraje_Desai Abhichandra_Charke Praneel_Deshmukh Rachit_Srivastava
148               70                 151              16                

Total Votes
Tvisha_Shah Gauravi_Zade Kirthika_Jayachander Naisha_Rastogi
41          252          20                   72             

Total Votes
Kausar_Chandra Sagnik_Ghosh Avaneesh_Mahalle Krishna_Yadav Viren_Jadhav
82             36           136              77            54           

Total Votes
Ketaki_Phalle Trisha_Kandpal Riya_Shirode Kavya_Mehta Sumedha_Vaidya
175           80             11           84          35             


                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
# candidate popularity trends - comparing candidate performances across classes

from matplotlib.ticker import MultipleLocator


def plot_popularity_trends(post_name: str, post_df: pd.DataFrame):

    # extracting rows belonging to a particular class from the post's dataframe using regular expressions
    class_wise_dataframes = [
        post_df[post_df.index.str.contains(_re)]
    ]

    # dividing the plot into 4 subplots
    fig, axes = plt.subplots(2, 2, figsize=(15, 7))

    subplot_positions = [
        (0, 0),
        (0, 1),
        (1, 0),
        (1, 1),
    ]  # since there are only 4 classes / subplots
    linestyles = [":", "-", "--", "-.", "solid"]

    for idx in range(4):
        pos = subplot_positions[idx]
        class_df = class_wise_dataframes[idx]
        sections = class_df.index

        for idx, (candidate_name, candidate_series) in enumerate(class_df.items()):
            # plotting a subplot for each class
            axes[pos].plot(sections, candidate_series, label=candidate_name.replace(_UNDERSCORE, _SPACE), linestyle=linestyles[idx])  # type: ignore

        axes[pos].set_xlabel("class")
        axes[pos].set_ylabel("Votes")

        axes[pos].set_ylim(0, post_df.max().max() + 1)

        # values on y-axis would have a difference of 1
        axes[pos].yaxis.set_major_locator(MultipleLocator(1))

    fig.suptitle(post_name, fontsize=32)

    # setting a common legend for the whole plot
    handles, labels = axes[0, 0].get_legend_handles_labels()
    fig.legend(handles, labels, loc="upper right", ncols=2, fontsize=15)

    plt.show()


plot_popularity_trends("Captain Boy", cb)
plot_popularity_trends("Captain Girl", cg)
plot_popularity_trends("Vice Captain Boy", vcb)
plot_popularity_trends("Vice Captain Boy", vcg)
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
total_classes = len(cb.index)


fig, axes = plt.subplots(2, 2, figsize=(10, 7.5), constrained_layout=True)
fig.suptitle("Percent Classes Won by Candidates", fontsize=32)

subplot_positions = [
        (0, 0),
        (0, 1),
        (1, 0),
        (1, 1),
    ]

colors = plt.cm.copper_r(np.linspace(0,0.50,5)) # type: ignore


for idx, (post_name, post_df) in enumerate(result_dataframes.items()):
    pos = subplot_positions[idx]

    classes_won_by_candidate_series = post_df.idxmax(1)
    count_series = (classes_won_by_candidate_series
                        .groupby(classes_won_by_candidate_series)
                        .count()
                        .sort_values(ascending=False)
                        )
    percents_series = count_series / total_classes
    
    max_val = percents_series.max()

    axes[pos].set_title(post_name)
    axes[pos].pie(
        percents_series,
        labels=percents_series.index.map(
            lambda name: name.replace(_UNDERSCORE, _SPACE)
        ),
        autopct="%1.1f%%",
        startangle=180,
        colors=colors,
    )
    axes[pos].set(aspect='equal')



plt.show()
                </code>
                </pre>
                <div class="output">
                <pre>

                </pre>
                </div>
                
                <div class="cell">
                <pre class="language-python">
                <code class="language-python">
print(f"Runtime of {(time() - start_time):.2f} seconds")
                </code>
                </pre>
                <div class="output">
                <pre>
Runtime of 9.27 seconds

                </pre>
                </div>
                             




























    </main>
    
</body>

</html>